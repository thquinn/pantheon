<!DOCTYPE html>
<html>
	<head>
		<title>Pantheon Wiki</title>
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Caladea:ital,wght@0,400;0,700;1,400&family=Calistoga&display=swap');
			html {
				font-family: 'Caladea', serif;
				font-size: 16px;
			}
			body { background-color: #222; }
			p { text-indent: 40px; }
			#wrapper { text-align: center; }
			#contents {
				display: inline-block;
				padding: 30px 40px 20px 40px;
				text-align: left;
				background-color: #EEE;
				margin-top: 50px;
				width: 800px;
				border-radius: 30px;
				border-color: #444;
				border-style: solid;
				border-width: 6px;
			}
			#title {
				font-family: 'Calistoga', cursive;
				font-size: 44px;
			}
			#text {
				padding: 0 40px 0 40px;
			}
			#sidebar {
				display: none;
				float: right;
				width: 300px;
				background-color: #FAFAFA;
				margin-left: 40px;
				padding: 8px 15px;
				border-radius: 4px;
				border-color: #888;
				border-style: groove;
				border-width: 4px;
			}
			#sidebar_header {
				font-weight: bold;
				text-align: center;
				margin-bottom: 10px;
			}
			.sidebar_row {
				display: flow-root;
				margin-bottom: 5px;
			}
			.sidebar_row_left {
				float: left;
				font-weight: bold;
			}
			.sidebar_row_right {
				float: right;
				text-align: right;
			}
		</style>
		<!-- Populate article -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.0/showdown.min.js"></script>
		<script type="text/javascript">
			function getQueryStringValue(key) {  
			  return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));  
			}
			function loadArticle() {
				if (!new URL(window.location.href).searchParams.get('article')) {
					window.location.href = "index.html?article=index";
					return;
				}
				var client = new XMLHttpRequest();
				client.open('GET', getQueryStringValue("article") + ".md");
				client.onreadystatechange = function() {
				  if (client.readyState != XMLHttpRequest.DONE) {
					return;
				  }
				  var md = client.responseText;
				  // Find JSON payload in markdown.
				  var i = 1;
				  var braces = 1;
				  while (braces > 0) {
					if (md.charAt(i) == '{') {
						braces++;
					} else if (md.charAt(i) == '}') {
						braces--;
					}
					i++;
				  }
				  var json = JSON.parse(md.substring(0, i));
				  md = md.substring(i);
				  document.title = "Pantheon Wiki: " + json["title"];
				  document.getElementById("title").innerHTML = json["title"];
				  
				  if ("sidebarHeader" in json) {
					var sidebar = document.getElementById("sidebar");
					sidebar.style.display = "block";
					sidebar.children[0].innerHTML = json["sidebarHeader"];
					var sidebarRowJSON = json["sidebarRows"];
					for (var key in sidebarRowJSON) {
						var sidebarRow = document.createElement("div");
						sidebarRow.className = "sidebar_row";
						var rowLeft = document.createElement("div");
						rowLeft.className = "sidebar_row_left";
						rowLeft.innerHTML = key;
						var rowRight = document.createElement("div");
						rowRight.className = "sidebar_row_right";
						rowRight.innerHTML = Array.isArray(sidebarRowJSON[key]) ? sidebarRowJSON[key].join("<br/>") : sidebarRowJSON[key];
						sidebarRow.appendChild(rowLeft);
						sidebarRow.appendChild(rowRight);
						sidebar.appendChild(sidebarRow);
					}
				  }

				  md = md.replace(/\[\[(.+)\]\]/g, '[$1](?article=$1)');
				  var converter = new showdown.Converter({noHeaderId: true, headerLevelStart: 2, simpleLineBreaks: true, parseImgDimensions: true});
				  document.getElementById("text").innerHTML = converter.makeHtml(md);
				}
				client.onerror = function() {
				  window.location.href = "?article=index";
				}
				client.send();
			}
			loadArticle();
		</script>
	</head>
	<body>
		<div id="wrapper">
			<div id="contents">
				<div id="sidebar">
					<div id="sidebar_header">Sidebar Header</div>
				</div>
				<div id="title">
					Article Title
				</div>
				<div id="text"></div>
			</div>
		</div>
	</body>
</html>